'use strict';

var fs = require('node:fs');
var path = require('node:path');

function _interopNamespaceDefault(e) {
    var n = Object.create(null);
    if (e) {
        Object.keys(e).forEach(function (k) {
            if (k !== 'default') {
                var d = Object.getOwnPropertyDescriptor(e, k);
                Object.defineProperty(n, k, d.get ? d : {
                    enumerable: true,
                    get: function () { return e[k]; }
                });
            }
        });
    }
    n.default = e;
    return Object.freeze(n);
}

var fs__namespace = /*#__PURE__*/_interopNamespaceDefault(fs);
var path__namespace = /*#__PURE__*/_interopNamespaceDefault(path);

const plugin = () => ({
    name: 'js-imports',
    resolveId(importee, importer) {
        if (importer?.includes('/node_modules/')) {
            return;
        }
        importee =
            importer === undefined
                ? importee
                : path__namespace.resolve(path__namespace.dirname(importer), importee);
        for (const extension of ['.js', '.jsx', '.cjs', '.mjs']) {
            if (importee.endsWith(extension)) {
                // Check if the TypeScript equivalent exists
                const typescriptFile = importee.replace(new RegExp(`\\${extension}$`), extension.replace('j', 't'));
                if (fs__namespace.existsSync(typescriptFile)) {
                    return typescriptFile;
                }
            }
        }
        const trimExtension = (filePath) => filePath.replace(/\.[^/.]+$/, "");
        // Check if the file exists without an extension (e.g. `.vue.js` -> `.vue`)
        const nonExtensionFile = trimExtension(importee);
        if (fs__namespace.existsSync(nonExtensionFile)) {
            return nonExtensionFile;
        }
    },
});

module.exports = plugin;
