{"ast":null,"code":"import axios from \"axios\";\nimport { mapGetters } from \"vuex\";\nexport default {\n  data() {\n    return {\n      promo: {\n        code: \"\",\n        discountType: \"percentage\",\n        discountValue: 0,\n        expiryDate: \"\",\n        usageLimit: 0,\n        minOrderAmount: 0,\n        products: []\n      },\n      promos: [],\n      // ✅ my promos\n      promois: [],\n      // ✅ promo orders\n      products: []\n    };\n  },\n  computed: {\n    ...mapGetters([\"getToken\"])\n  },\n  methods: {\n    isPromoActive(promo) {\n      const now = new Date();\n      const expiry = new Date(promo.expiryDate);\n      return promo.usedCount < promo.usageLimit && expiry >= now;\n    },\n    formatDate(date) {\n      if (!date) return \"-\";\n      return new Date(date).toLocaleDateString();\n    },\n    async createPromo() {\n      try {\n        await axios.post(\"https://event-ticket-backend-gnmw.onrender.com/api/create-promo\", this.promo, {\n          headers: {\n            Authorization: `Bearer ${this.getToken}`\n          }\n        });\n      } catch (err) {\n        console.error(err.response?.data || err.message);\n      }\n      this.fetchMyPromos();\n    },\n    async fetchMyPromos() {\n      try {\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/my-promos\", {\n          headers: {\n            Authorization: `Bearer ${this.getToken}`\n          }\n        });\n        console.log(\"Token:\", this.getToken);\n        this.promos = res.data.promos || [];\n        console.log(this.promos);\n      } catch (err) {\n        console.error(\"Error fetching my promos:\", err.response?.data || err.message);\n      }\n    },\n    async fetchPromos() {\n      try {\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/promo-orders\", {\n          headers: {\n            Authorization: `Bearer ${this.getToken}`\n          }\n        });\n        // ✅ FIX: your API returns { success: true, data: [...] }\n        this.promois = res.data.data || [];\n      } catch (err) {\n        console.error(\"Error fetching promo orders:\", err.response?.data || err.message);\n      }\n    },\n    async fetchProducts() {\n      try {\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/user/products\", {\n          headers: {\n            Authorization: `Bearer ${this.getToken}`\n          }\n        });\n        this.products = res.data.products;\n      } catch (error) {\n        console.error(\"Error fetching products:\", error);\n      }\n    }\n  },\n  mounted() {\n    this.fetchProducts();\n    this.fetchMyPromos();\n    this.fetchPromos();\n  }\n};","map":{"version":3,"names":["axios","mapGetters","data","promo","code","discountType","discountValue","expiryDate","usageLimit","minOrderAmount","products","promos","promois","computed","methods","isPromoActive","now","Date","expiry","usedCount","formatDate","date","toLocaleDateString","createPromo","post","headers","Authorization","getToken","err","console","error","response","message","fetchMyPromos","res","get","log","fetchPromos","fetchProducts","mounted"],"sources":["C:\\Users\\ajib\\OneDrive\\Desktop\\xASn2901-Daredevil\\event-ticket-frontend\\src\\components\\dashboard\\discount.vue"],"sourcesContent":["<template>\r\n  <div class=\"\">\r\n    <!-- Create Promo Form -->\r\n\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-12 col-sm-10 col-md-8 col-lg-6\">\r\n        <form @submit.prevent=\"createPromo\" class=\"mx-auto mb-4\">\r\n          <div class=\"card shadow-sm\">\r\n            <div class=\"text-center bg-success p-2 text-white\">\r\n              <h5 class=\"mb-0\">Create Promo Code</h5>\r\n            </div>\r\n            <div class=\"card-body\">\r\n              <div class=\"row g-3\">\r\n                <div class=\"col-md-6\">\r\n                  <label class=\"form-label\">Enter Promo Code</label>\r\n                  <input v-model=\"promo.code\" placeholder=\"Code\" class=\"form-control\" />\r\n                </div>\r\n\r\n                <div class=\"col-md-6\">\r\n                  <label class=\"form-label\">Enter Discount Type</label>\r\n                  <select v-model=\"promo.discountType\" class=\"form-select\">\r\n                    <option value=\"percentage\">Percentage</option>\r\n                    <option value=\"fixed\">Fixed</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div class=\"col-md-6\">\r\n                  <label class=\"form-label\">Enter Discount Value</label>\r\n                  <input\r\n                    v-model.number=\"promo.discountValue\"\r\n                    type=\"number\"\r\n                    placeholder=\"Discount Value\"\r\n                    class=\"form-control\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"col-md-6\">\r\n                  <label class=\"form-label\">Expiry Date</label>\r\n                  <input v-model=\"promo.expiryDate\" type=\"date\" class=\"form-control\" />\r\n                </div>\r\n\r\n                <div class=\"col-md-6\">\r\n                  <label class=\"form-label\">usage Limit</label>\r\n                  <input\r\n                    v-model.number=\"promo.usageLimit\"\r\n                    type=\"number\"\r\n                    placeholder=\"Usage Limit\"\r\n                    class=\"form-control\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"col-12\">\r\n                  <label class=\"form-label\">Select Events</label>\r\n                  <div v-for=\"product in products\" :key=\"product._id\" class=\"form-check\">\r\n                    <input\r\n                      class=\"form-check-input\"\r\n                      type=\"checkbox\"\r\n                      :value=\"product._id\"\r\n                      v-model=\"promo.products\"\r\n                      :id=\"'product-' + product._id\"\r\n                    />\r\n                    <label class=\"form-check-label\" :for=\"'product-' + product._id\">\r\n                      {{ product.title }}\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-12 text-center\">\r\n                  <button type=\"submit\" class=\"btn btn-sm btn-primary\">\r\n                    Create Promo\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- ✅ My Promos -->\r\n    <div class=\"container my-4\">\r\n      <!-- My Promos -->\r\n      <div class=\"card mb-4 shadow-sm\">\r\n        <div class=\"text-center bg-success p-2 text-white\">\r\n          <h5 class=\"mb-0\">My Promos</h5>\r\n        </div>\r\n        <div class=\"card-body p-0\">\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-striped mb-0\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Code</th>\r\n                  <th>Discount</th>\r\n                  <th>Usage Limit</th>\r\n                  <th>used Count</th>\r\n                  <th>Expiry</th>\r\n                  <th>Status</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr v-if=\"promos.length === 0\">\r\n                  <td colspan=\"4\" class=\"text-center text-muted\">No promos available</td>\r\n                </tr>\r\n                <tr v-for=\"promo in promos\" :key=\"promo._id\">\r\n                  <td>{{ promo.code }}</td>\r\n                  <td>{{ promo.discountValue }}%</td>\r\n                  <td>{{ promo.usageLimit }}</td>\r\n                  <td>{{ promo.usedCount }}</td>\r\n                  <td>{{ formatDate(promo.expiryDate) }}</td>\r\n                  <td>\r\n                    <span\r\n                      class=\"badge\"\r\n                      :class=\"isPromoActive(promo) ? 'bg-success' : 'bg-secondary'\"\r\n                    >\r\n                      {{ isPromoActive(promo) ? \"Active\" : \"Inactive\" }}\r\n                    </span>\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Promo Orders -->\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"text-center bg-success p-2 text-white\">\r\n          <h5 class=\"mb-0\">Promo Orders</h5>\r\n        </div>\r\n        <div class=\"card-body p-0\">\r\n          <div class=\"table-responsive\">\r\n            <table class=\"table table-striped mb-0\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Order ID</th>\r\n                  <th>Order title</th>\r\n                  <th>Promo Code</th>\r\n                  <th>Amount</th>\r\n                  <th>order Date</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr v-if=\"promois.length === 0\">\r\n                  <td colspan=\"4\" class=\"text-center text-muted\">No promo orders</td>\r\n                </tr>\r\n                <tr v-for=\"order in promois\" :key=\"order._id\">\r\n                  <td>{{ order.promoId }}</td>\r\n                  <td>{{ order.title }}</td>\r\n                  <td>{{ order.promoCode }}</td>\r\n                  <td>₦{{ order.price }}</td>\r\n                  <td>{{ formatDate(order.createdAt) }}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { mapGetters } from \"vuex\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      promo: {\r\n        code: \"\",\r\n        discountType: \"percentage\",\r\n        discountValue: 0,\r\n        expiryDate: \"\",\r\n        usageLimit: 0,\r\n        minOrderAmount: 0,\r\n        products: [],\r\n      },\r\n      promos: [], // ✅ my promos\r\n      promois: [], // ✅ promo orders\r\n      products: [],\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"getToken\"]),\r\n  },\r\n  methods: {\r\n    isPromoActive(promo) {\r\n      const now = new Date();\r\n      const expiry = new Date(promo.expiryDate);\r\n      return promo.usedCount < promo.usageLimit && expiry >= now;\r\n    },\r\n    formatDate(date) {\r\n      if (!date) return \"-\";\r\n      return new Date(date).toLocaleDateString();\r\n    },\r\n    async createPromo() {\r\n      try {\r\n        await axios.post(\"https://event-ticket-backend-gnmw.onrender.com/api/create-promo\", this.promo, {\r\n          headers: { Authorization: `Bearer ${this.getToken}` },\r\n        });\r\n      } catch (err) {\r\n        console.error(err.response?.data || err.message);\r\n      }\r\n      this.fetchMyPromos();\r\n    },\r\n\r\n    async fetchMyPromos() {\r\n      try {\r\n       \r\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/my-promos\", {\r\n          headers: { Authorization: `Bearer ${this.getToken}` },\r\n        });\r\n        console.log(\"Token:\", this.getToken);\r\n\r\n        this.promos = res.data.promos || [];\r\n        console.log(this.promos);\r\n      } catch (err) {\r\n        console.error(\"Error fetching my promos:\", err.response?.data || err.message);\r\n      }\r\n    },\r\n\r\n    async fetchPromos() {\r\n      try {\r\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/promo-orders\", {\r\n          headers: { Authorization: `Bearer ${this.getToken}` },\r\n        });\r\n        // ✅ FIX: your API returns { success: true, data: [...] }\r\n        this.promois = res.data.data || [];\r\n      } catch (err) {\r\n        console.error(\"Error fetching promo orders:\", err.response?.data || err.message);\r\n      }\r\n    },\r\n\r\n    async fetchProducts() {\r\n      try {\r\n        const res = await axios.get(\"https://event-ticket-backend-gnmw.onrender.com/api/user/products\", {\r\n          headers: { Authorization: `Bearer ${this.getToken}` },\r\n        });\r\n        this.products = res.data.products;\r\n      } catch (error) {\r\n        console.error(\"Error fetching products:\", error);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchProducts();\r\n    this.fetchMyPromos();\r\n    this.fetchPromos();\r\n  },\r\n};\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}