{"ast":null,"code":"// store/index.js\n\nimport axios from \"axios\";\nimport axiosInstance from \"@/helpers/axiosInstance\";\nimport Swal from \"sweetalert2\";\nimport router from \"@/router\";\nconst state = {\n  users: [],\n  user: null,\n  error: null,\n  userDetails: null,\n  token: null\n};\nconst mutations = {\n  SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_USER_DETAILS(state, userDetails) {\n    state.userDetails = userDetails;\n  },\n  SET_USERS(state, users) {\n    state.users = users;\n  },\n  setUser(state, user) {\n    state.user = user;\n  },\n  setError(state, error) {\n    state.error = error;\n  },\n  logout(state) {\n    state.user = null;\n    state.userDetails = null;\n    state.token = null;\n    state.users = [];\n    state.error = null;\n  }\n};\nconst actions = {\n  setToken({\n    commit\n  }, token) {\n    commit(\"setToken\", token);\n  },\n  getTokenFromStorage({\n    commit\n  }) {\n    const token = localStorage.getItem(\"token\");\n    commit(\"SET_TOKEN\", token);\n  },\n  REGISTER_USER({\n    commit\n  }, payload) {\n    return new Promise((resolve, reject) => {\n      axios.post(\"https://event-ticket-backend-gnmw.onrender.com/api/auth/signup\", payload).then(res => {\n        if (res.data.success == true) {\n          resolve(res.data);\n        }\n      }).catch(err => {\n        reject(err.response.data);\n      });\n    });\n  },\n  // store/auth.js (Vuex action)\n  LOGIN_USER({\n    commit\n  }, payload) {\n    return new Promise((resolve, reject) => {\n      axios.post(\"https://event-ticket-backend-gnmw.onrender.com/api/auth/login\", payload).then(res => {\n        if (res.data.success) {\n          const token = res.data.token;\n\n          // ✅ Save token\n          localStorage.setItem(\"token\", token);\n\n          // ✅ Set axios auth header for future requests\n          axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n\n          // ✅ Commit to store\n          commit(\"SET_TOKEN\", token);\n          resolve(res.data);\n        } else {\n          reject(res.data);\n        }\n        // window.location.href = \"/dashboard\";\n      }).catch(err => {\n        reject(err.response.data);\n      });\n    });\n  },\n  logout({\n    commit\n  }) {\n    commit(\"logout\");\n    localStorage.removeItem(\"token\");\n    delete axiosInstance.defaults.headers.common[\"Authorization\"];\n    window.location.href = \"/login\";\n  },\n  async sendCodeToBackend({\n    commit\n  }, code) {\n    try {\n      const headers = {\n        Authorization: code\n      };\n      console.log(\"Authorization header:\", headers.Authorization);\n      const response = await axiosInstance.post(\"https://event-ticket-backend-gnmw.onrender.com/api/auth/google\", null, {\n        headers\n      });\n      const userDetails = response.data;\n      commit(\"SET_USER_DETAILS\", userDetails);\n      localStorage.setItem(\"token\", response.data.token);\n      Swal.fire(\"login successful\");\n      //  window.location.href = \"/dashboard\";\n    } catch (error) {\n      console.error(\"Failed to send authorization code:\", error);\n    }\n  },\n  fetchUsers({\n    commit\n  }) {\n    return axiosInstance.get(\"/users\").then(response => {\n      // console.log(response)\n      commit(\"SET_USERS\", response.data.users);\n      return dispatch(\"fetchAddressesForUsers\", users);\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n  getUser({\n    commit\n  }) {\n    const token = localStorage.getItem(\"token\");\n    if (!token) {\n      commit(\"setError\", \"No token available\");\n      return Promise.reject(\"No token available\");\n    }\n    return axiosInstance.get(\"/auth/user\", {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(response => {\n      const user = response.data.user;\n      user.isAdmin = user.isAdmin === true; // Assuming the isAdmin property is already a boolean\n      commit(\"setUser\", user);\n      return user;\n    }).catch(error => {\n      commit(\"setError\", error.response.data.message);\n      return Promise.reject(error.response.data.message);\n    });\n  },\n  setToken({\n    commit\n  }, token) {\n    commit(\"SET_TOKEN\", token);\n  }\n};\nconst getters = {\n  getToken(state) {\n    return state.token;\n  },\n  isAdmin: state => state.user && state.user.role === \"admin\",\n  isUser: state => state.user && (state.user.role === \"user\" || state.user.role === \"admin\"),\n  totalUserPercent(state) {\n    const totalUsers = state.users.length;\n    //console.log(totalUsers)\n    return totalUsers / 100;\n  },\n  getUsers: state => {\n    return state.users;\n  },\n  getUser(state) {\n    return state.user;\n  },\n  currentUser(state) {\n    return state.user;\n  },\n  error(state) {\n    return state.error;\n  }\n};\nexport default {\n  state,\n  mutations,\n  actions,\n  getters\n};","map":{"version":3,"names":["axios","axiosInstance","Swal","router","state","users","user","error","userDetails","token","mutations","SET_TOKEN","SET_USER_DETAILS","SET_USERS","setUser","setError","logout","actions","setToken","commit","getTokenFromStorage","localStorage","getItem","REGISTER_USER","payload","Promise","resolve","reject","post","then","res","data","success","catch","err","response","LOGIN_USER","setItem","defaults","headers","common","removeItem","window","location","href","sendCodeToBackend","code","Authorization","console","log","fire","fetchUsers","get","dispatch","getUser","isAdmin","message","getters","getToken","role","isUser","totalUserPercent","totalUsers","length","getUsers","currentUser"],"sources":["C:/Users/ajib/OneDrive/Desktop/xASn2901-Daredevil/event-ticket-frontend/src/store/modules/auth.js"],"sourcesContent":["// store/index.js\r\n\r\nimport axios from \"axios\";\r\nimport axiosInstance from \"@/helpers/axiosInstance\";\r\nimport Swal from \"sweetalert2\";\r\nimport router from \"@/router\";\r\n\r\nconst state = {\r\n  users: [],\r\n  user: null,\r\n  error: null,\r\n  userDetails: null,\r\n  token: null,\r\n};\r\nconst mutations = {\r\n  SET_TOKEN(state, token) {\r\n    state.token = token;\r\n  },\r\n  SET_USER_DETAILS(state, userDetails) {\r\n    state.userDetails = userDetails;\r\n  },\r\n  SET_USERS(state, users) {\r\n    state.users = users;\r\n  },\r\n  setUser(state, user) {\r\n    state.user = user;\r\n  },\r\n  setError(state, error) {\r\n    state.error = error;\r\n  },\r\n  logout(state) {\r\n    state.user = null;\r\n    state.userDetails = null;\r\n    state.token = null;\r\n    state.users = [];\r\n    state.error = null;\r\n  },\r\n};\r\nconst actions = {\r\n  setToken({ commit }, token) {\r\n    commit(\"setToken\", token);\r\n  },\r\n  getTokenFromStorage({ commit }) {\r\n    const token = localStorage.getItem(\"token\");\r\n    commit(\"SET_TOKEN\", token);\r\n  },\r\n  REGISTER_USER({ commit }, payload) {\r\n    return new Promise((resolve, reject) => {\r\n      axios\r\n        .post(\"https://event-ticket-backend-gnmw.onrender.com/api/auth/signup\", payload)\r\n        .then((res) => {\r\n          if (res.data.success == true) {\r\n            resolve(res.data);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          reject(err.response.data);\r\n        });\r\n    });\r\n  },\r\n  // store/auth.js (Vuex action)\r\n  LOGIN_USER({ commit }, payload) {\r\n    return new Promise((resolve, reject) => {\r\n      axios\r\n        .post(\"https://event-ticket-backend-gnmw.onrender.com/api/auth/login\", payload)\r\n        .then((res) => {\r\n          if (res.data.success) {\r\n            const token = res.data.token;\r\n\r\n            // ✅ Save token\r\n            localStorage.setItem(\"token\", token);\r\n\r\n            // ✅ Set axios auth header for future requests\r\n            axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n            // ✅ Commit to store\r\n            commit(\"SET_TOKEN\", token);\r\n\r\n            resolve(res.data);\r\n          } else {\r\n            reject(res.data);\r\n          }\r\n         // window.location.href = \"/dashboard\";\r\n        })\r\n        .catch((err) => {\r\n          reject(err.response.data);\r\n        });\r\n    });\r\n  },\r\n\r\n  logout({ commit }) {\r\n    commit(\"logout\");\r\n    localStorage.removeItem(\"token\");\r\n    delete axiosInstance.defaults.headers.common[\"Authorization\"];\r\n    window.location.href = \"/login\";\r\n  },\r\n  async sendCodeToBackend({ commit }, code) {\r\n    try {\r\n      const headers = {\r\n        Authorization: code,\r\n      };\r\n      console.log(\"Authorization header:\", headers.Authorization);\r\n\r\n      const response = await axiosInstance.post(\r\n        \"https://event-ticket-backend-gnmw.onrender.com/api/auth/google\",\r\n        null,\r\n        { headers }\r\n      );\r\n      const userDetails = response.data;\r\n\r\n      commit(\"SET_USER_DETAILS\", userDetails);\r\n\r\n      localStorage.setItem(\"token\", response.data.token);\r\n      Swal.fire(\"login successful\");\r\n      //  window.location.href = \"/dashboard\";\r\n    } catch (error) {\r\n      console.error(\"Failed to send authorization code:\", error);\r\n    }\r\n  },\r\n\r\n  fetchUsers({ commit }) {\r\n    return axiosInstance\r\n      .get(\"/users\")\r\n      .then((response) => {\r\n        // console.log(response)\r\n        commit(\"SET_USERS\", response.data.users);\r\n        return dispatch(\"fetchAddressesForUsers\", users);\r\n      })\r\n      .catch((error) => {\r\n        console.error(error);\r\n      });\r\n  },\r\n  getUser({ commit }) {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      commit(\"setError\", \"No token available\");\r\n      return Promise.reject(\"No token available\");\r\n    }\r\n\r\n    return axiosInstance\r\n      .get(\"/auth/user\", {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n      .then((response) => {\r\n        const user = response.data.user;\r\n        user.isAdmin = user.isAdmin === true; // Assuming the isAdmin property is already a boolean\r\n        commit(\"setUser\", user);\r\n        return user;\r\n      })\r\n      .catch((error) => {\r\n        commit(\"setError\", error.response.data.message);\r\n        return Promise.reject(error.response.data.message);\r\n      });\r\n  },\r\n\r\n  setToken({ commit }, token) {\r\n    commit(\"SET_TOKEN\", token);\r\n  },\r\n};\r\nconst getters = {\r\n  getToken(state) {\r\n    return state.token;\r\n  },\r\n  isAdmin: (state) => state.user && state.user.role === \"admin\",\r\n  isUser: (state) =>\r\n    state.user && (state.user.role === \"user\" || state.user.role === \"admin\"),\r\n\r\n  totalUserPercent(state) {\r\n    const totalUsers = state.users.length;\r\n    //console.log(totalUsers)\r\n    return totalUsers / 100;\r\n  },\r\n\r\n  getUsers: (state) => {\r\n    return state.users;\r\n  },\r\n  getUser(state) {\r\n    return state.user;\r\n  },\r\n\r\n  currentUser(state) {\r\n    return state.user;\r\n  },\r\n  error(state) {\r\n    return state.error;\r\n  },\r\n};\r\n\r\nexport default {\r\n  state,\r\n  mutations,\r\n  actions,\r\n  getters,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}