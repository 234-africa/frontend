{"ast":null,"code":"// store/index.js\n\nimport axios from \"axios\";\nimport axiosInstance from \"@/helpers/axiosInstance\";\nimport Swal from \"sweetalert2\";\nimport router from \"@/router\";\nconst state = {\n  users: [],\n  user: null,\n  error: null,\n  userDetails: null,\n  token: null\n};\nconst mutations = {\n  SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_USER_DETAILS(state, userDetails) {\n    state.userDetails = userDetails;\n  },\n  SET_USERS(state, users) {\n    state.users = users;\n  },\n  setUser(state, user) {\n    state.user = user;\n  },\n  setError(state, error) {\n    state.error = error;\n  },\n  logout(state) {\n    state.user = null;\n    state.userDetails = null;\n    state.token = null;\n    state.users = [];\n    state.error = null;\n  }\n};\nconst actions = {\n  async initAuth({\n    dispatch,\n    commit\n  }) {\n    const token = localStorage.getItem(\"token\");\n    if (!token) {\n      commit(\"logout\");\n      return;\n    }\n    commit(\"SET_TOKEN\", token);\n    try {\n      await dispatch(\"getUser\"); // fetch user details from API\n    } catch (err) {\n      commit(\"logout\");\n    }\n  },\n  setToken({\n    commit\n  }, token) {\n    commit(\"setToken\", token);\n  },\n  getTokenFromStorage({\n    commit\n  }) {\n    const token = localStorage.getItem(\"token\");\n    commit(\"SET_TOKEN\", token);\n  },\n  REGISTER_USER({\n    commit\n  }, payload) {\n    return new Promise((resolve, reject) => {\n      axios.post(\"https://event-ticket-backend-yx81.onrender.com/api/auth/signup\", payload).then(res => {\n        if (res.data.success == true) {\n          resolve(res.data);\n        }\n      }).catch(err => {\n        reject(err.response.data);\n      });\n    });\n  },\n  LOGIN_USER({\n    commit\n  }, payload) {\n    return new Promise((resolve, reject) => {\n      axios.post(\"https://event-ticket-backend-yx81.onrender.com/api/auth/login\", payload).then(res => {\n        if (res.data.success == true) {\n          const token = res.data.token;\n          localStorage.setItem(\"token\", token);\n          resolve(res.data);\n        } else {\n          reject(res.data);\n        }\n        window.location.href = \"/dashboard\";\n      }).catch(err => {\n        reject(err.response.data);\n      });\n    });\n  },\n  logout({\n    commit\n  }) {\n    commit(\"logout\");\n    localStorage.removeItem(\"token\");\n    delete axiosInstance.defaults.headers.common[\"Authorization\"];\n    window.location.href = \"/login\";\n  },\n  async sendCodeToBackend({\n    commit\n  }, code) {\n    try {\n      const headers = {\n        Authorization: code\n      };\n      console.log(\"Authorization header:\", headers.Authorization);\n      const response = await axiosInstance.post(\"https://event-ticket-backend-yx81.onrender.com/api/auth/google\", null, {\n        headers\n      });\n      const userDetails = response.data;\n      commit(\"SET_USER_DETAILS\", userDetails);\n      localStorage.setItem(\"token\", response.data.token);\n      Swal.fire(\"login successful\");\n      window.location.href = \"/dashboard\";\n    } catch (error) {\n      console.error(\"Failed to send authorization code:\", error);\n    }\n  },\n  fetchUsers({\n    commit\n  }) {\n    return axiosInstance.get(\"/users\").then(response => {\n      // console.log(response)\n      commit(\"SET_USERS\", response.data.users);\n      return dispatch(\"fetchAddressesForUsers\", users);\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n  getUser({\n    commit\n  }) {\n    const token = localStorage.getItem(\"token\");\n    if (!token) {\n      commit(\"setError\", \"No token available\");\n      return Promise.reject(\"No token available\");\n    }\n    return axiosInstance.get(\"/auth/user\", {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(response => {\n      const user = response.data.user;\n      user.isAdmin = user.isAdmin === true; // Assuming the isAdmin property is already a boolean\n      commit(\"setUser\", user);\n      return user;\n    }).catch(error => {\n      commit(\"setError\", error.response.data.message);\n      return Promise.reject(error.response.data.message);\n    });\n  },\n  setToken({\n    commit\n  }, token) {\n    commit(\"SET_TOKEN\", token);\n  }\n};\nconst getters = {\n  getToken(state) {\n    return state.token;\n  },\n  isAdmin: state => state.user && state.user.role === \"admin\",\n  isUser: state => state.user && (state.user.role === \"user\" || state.user.role === \"admin\"),\n  totalUserPercent(state) {\n    const totalUsers = state.users.length;\n    //console.log(totalUsers)\n    return totalUsers / 100;\n  },\n  getUsers: state => {\n    return state.users;\n  },\n  getUser(state) {\n    return state.user;\n  },\n  currentUser(state) {\n    return state.user;\n  },\n  error(state) {\n    return state.error;\n  }\n};\nexport default {\n  state,\n  mutations,\n  actions,\n  getters\n};","map":{"version":3,"names":["axios","axiosInstance","Swal","router","state","users","user","error","userDetails","token","mutations","SET_TOKEN","SET_USER_DETAILS","SET_USERS","setUser","setError","logout","actions","initAuth","dispatch","commit","localStorage","getItem","err","setToken","getTokenFromStorage","REGISTER_USER","payload","Promise","resolve","reject","post","then","res","data","success","catch","response","LOGIN_USER","setItem","window","location","href","removeItem","defaults","headers","common","sendCodeToBackend","code","Authorization","console","log","fire","fetchUsers","get","getUser","isAdmin","message","getters","getToken","role","isUser","totalUserPercent","totalUsers","length","getUsers","currentUser"],"sources":["C:/Users/ajib/OneDrive/Desktop/event-ticket/New folder/event-ticket-frontend/src/store/modules/auth.js"],"sourcesContent":["// store/index.js\r\n\r\nimport axios from \"axios\";\r\nimport axiosInstance from \"@/helpers/axiosInstance\";\r\nimport Swal from \"sweetalert2\";\r\nimport router from \"@/router\";\r\n\r\nconst state = {\r\n  users: [],\r\n  user: null,\r\n  error: null,\r\n  userDetails: null,\r\n  token: null,\r\n};\r\nconst mutations = {\r\n  SET_TOKEN(state, token) {\r\n    state.token = token;\r\n  },\r\n  SET_USER_DETAILS(state, userDetails) {\r\n    state.userDetails = userDetails;\r\n  },\r\n  SET_USERS(state, users) {\r\n    state.users = users;\r\n  },\r\n  setUser(state, user) {\r\n    state.user = user;\r\n  },\r\n  setError(state, error) {\r\n    state.error = error;\r\n  },\r\n   logout(state) {\r\n    state.user = null;\r\n    state.userDetails = null;\r\n    state.token = null;\r\n    state.users = [];\r\n    state.error = null;\r\n  },\r\n};\r\nconst actions = {\r\n    async initAuth({ dispatch, commit }) {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      commit(\"logout\");\r\n      return;\r\n    }\r\n\r\n    commit(\"SET_TOKEN\", token);\r\n\r\n    try {\r\n      await dispatch(\"getUser\"); // fetch user details from API\r\n    } catch (err) {\r\n      commit(\"logout\");\r\n    }\r\n  },\r\n  \r\n  setToken({ commit }, token) {\r\n    commit(\"setToken\", token);\r\n  },\r\n  getTokenFromStorage({ commit }) {\r\n    const token = localStorage.getItem(\"token\");\r\n    commit(\"SET_TOKEN\", token);\r\n  },\r\n  REGISTER_USER({ commit }, payload) {\r\n    return new Promise((resolve, reject) => {\r\n      axios\r\n        .post(\"https://event-ticket-backend-yx81.onrender.com/api/auth/signup\", payload)\r\n        .then((res) => {\r\n          if (res.data.success == true) {\r\n            resolve(res.data);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          reject(err.response.data);\r\n        });\r\n    });\r\n  },\r\n  LOGIN_USER({ commit }, payload) {\r\n    return new Promise((resolve, reject) => {\r\n      axios\r\n        .post(\"https://event-ticket-backend-yx81.onrender.com/api/auth/login\", payload)\r\n        .then((res) => {\r\n          if (res.data.success == true) {\r\n            const token = res.data.token;\r\n            localStorage.setItem(\"token\", token);\r\n            resolve(res.data);\r\n          } else {\r\n            reject(res.data);\r\n          }\r\n          window.location.href = \"/dashboard\";\r\n        })\r\n        .catch((err) => {\r\n          reject(err.response.data);\r\n        });\r\n    });\r\n  },\r\n\r\n  logout({ commit }) {\r\n  commit(\"logout\");\r\n  localStorage.removeItem(\"token\");\r\n  delete axiosInstance.defaults.headers.common[\"Authorization\"];\r\n  window.location.href = \"/login\";\r\n},\r\n  async sendCodeToBackend({ commit }, code) {\r\n    try {\r\n      const headers = {\r\n        Authorization: code,\r\n      };\r\n      console.log(\"Authorization header:\", headers.Authorization);\r\n\r\n      const response = await axiosInstance.post(\r\n        \"https://event-ticket-backend-yx81.onrender.com/api/auth/google\",\r\n        null,\r\n        { headers }\r\n      );\r\n      const userDetails = response.data;\r\n\r\n      commit(\"SET_USER_DETAILS\", userDetails);\r\n\r\n      localStorage.setItem(\"token\", response.data.token);\r\n      Swal.fire(\"login successful\");\r\n      window.location.href = \"/dashboard\";\r\n    } catch (error) {\r\n      console.error(\"Failed to send authorization code:\", error);\r\n    }\r\n  },\r\n\r\n  fetchUsers({ commit }) {\r\n    return axiosInstance\r\n      .get(\"/users\")\r\n      .then((response) => {\r\n        // console.log(response)\r\n        commit(\"SET_USERS\", response.data.users);\r\n        return dispatch(\"fetchAddressesForUsers\", users);\r\n      })\r\n      .catch((error) => {\r\n        console.error(error);\r\n      });\r\n  },\r\n  getUser({ commit }) {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (!token) {\r\n      commit(\"setError\", \"No token available\");\r\n      return Promise.reject(\"No token available\");\r\n    }\r\n\r\n    return axiosInstance\r\n      .get(\"/auth/user\", {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n      .then((response) => {\r\n        const user = response.data.user;\r\n        user.isAdmin = user.isAdmin === true; // Assuming the isAdmin property is already a boolean\r\n        commit(\"setUser\", user);\r\n        return user;\r\n      })\r\n      .catch((error) => {\r\n        commit(\"setError\", error.response.data.message);\r\n        return Promise.reject(error.response.data.message);\r\n      });\r\n  },\r\n\r\n  setToken({ commit }, token) {\r\n    commit(\"SET_TOKEN\", token);\r\n  },\r\n};\r\nconst getters = {\r\n  getToken(state) {\r\n    return state.token;\r\n  },\r\n  isAdmin: (state) => state.user && state.user.role === \"admin\",\r\n  isUser: (state) =>\r\n    state.user && (state.user.role === \"user\" || state.user.role === \"admin\"),\r\n\r\n  totalUserPercent(state) {\r\n    const totalUsers = state.users.length;\r\n    //console.log(totalUsers)\r\n    return totalUsers / 100;\r\n  },\r\n\r\n  getUsers: (state) => {\r\n    return state.users;\r\n  },\r\n  getUser(state) {\r\n    return state.user;\r\n  },\r\n\r\n  currentUser(state) {\r\n    return state.user;\r\n  },\r\n  error(state) {\r\n    return state.error;\r\n  },\r\n};\r\n\r\nexport default {\r\n  state,\r\n  mutations,\r\n  actions,\r\n  getters,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}